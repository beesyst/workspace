# Linux: Полезные команды для администрирования и DevOps

## Оглавление

## Оглавление

- [Основные команды](#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5-%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D1%8B)
- [Управление файлами и каталогами](#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D1%84%D0%B0%D0%B9%D0%BB%D0%B0%D0%BC%D0%B8-%D0%B8-%D0%BA%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%D0%B0%D0%BC%D0%B8)
- [Процессы и диагностика](#%D0%9F%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D1%8B-%D0%B8-%D0%B4%D0%B8%D0%B0%D0%B3%D0%BD%D0%BE%D1%81%D1%82%D0%B8%D0%BA%D0%B0)
- [Управление пользователями и группами](#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%D0%BC%D0%B8-%D0%B8-%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D0%B0%D0%BC%D0%B8)
- [Сеть и безопасность](#%D0%A1%D0%B5%D1%82%D1%8C-%D0%B8-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C)
- [Контейнеры (Docker / Podman / Kubernetes / CRI)](#%D0%9A%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D1%8B-docker--podman--kubernetes--cri)
- [Файлы и операции](#%D0%A4%D0%B0%D0%B9%D0%BB%D1%8B-%D0%B8-%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B8)
- [Управление пакетами и приложениями](#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%B0%D0%BC%D0%B8-%D0%B8-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F%D0%BC%D0%B8)
- [Управление сервисами](#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%D0%BC%D0%B8)
- [Система и питание](#%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0-%D0%B8-%D0%BF%D0%B8%D1%82%D0%B0%D0%BD%D0%B8%D0%B5)
- [Планирование задач](#%D0%9F%D0%BB%D0%B0%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B7%D0%B0%D0%B4%D0%B0%D1%87)
- [Git и разработка](#git-%D0%B8-%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0)
- [Управление памятью](#%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D1%8C%D1%8E)
- [Часто используемые сценарии](#%D0%A7%D0%B0%D1%81%D1%82%D0%BE-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D0%B5%D0%BC%D1%8B%D0%B5-%D1%81%D1%86%D0%B5%D0%BD%D0%B0%D1%80%D0%B8%D0%B8)
  - [Найти процесс по имени](#%D0%9D%D0%B0%D0%B9%D1%82%D0%B8-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81-%D0%BF%D0%BE-%D0%B8%D0%BC%D0%B5%D0%BD%D0%B8)
  - [Проверить, кто держит порт 8080](#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%B8%D1%82%D1%8C-%D0%BA%D1%82%D0%BE-%D0%B4%D0%B5%D1%80%D0%B6%D0%B8%D1%82-%D0%BF%D0%BE%D1%80%D1%82-8080)
  - [Мониторинг логов](#%D0%9C%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3-%D0%BB%D0%BE%D0%B3%D0%BE%D0%B2)
  - [Проверить проблемные контейнеры](#%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%B8%D1%82%D1%8C-%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%BD%D1%8B%D0%B5-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D1%8B)
  - [Анализ сетевых пакетов по интерфейсу eth0](#%D0%90%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7-%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D1%85-%D0%BF%D0%B0%D0%BA%D0%B5%D1%82%D0%BE%D0%B2-%D0%BF%D0%BE-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81%D1%83-eth0)
  - [Древо процессов nginx + аптайм (колонка ETIME)](#%D0%94%D1%80%D0%B5%D0%B2%D0%BE-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D0%B2-nginx--%D0%B0%D0%BF%D1%82%D0%B0%D0%B9%D0%BC-%D0%BA%D0%BE%D0%BB%D0%BE%D0%BD%D0%BA%D0%B0-etime)

---

## Основные команды

| Команда | Описание |
|----------|-----------|
| `sudo !!` | Повтор последней команды с правами root |
| `ctrl + r` | Поиск по истории команд |
| `history \| grep` | Фильтрация истории |
| `alias` | Создание коротких команд |
| `watch` | Повторное выполнение команды через интервал |
| `uptime` | Проверка времени работы и средней нагрузки |
| `top -c` | Просмотр процессов в реальном времени |
| `htop` | Улучшенная версия top |
| `free -h` | Проверка использования памяти |
| `df -h` | Проверить свободное место на диске |
| `vmstat 1` | Мониторинг метрик системы в реальном времени |
| `dmesg -T \| tail` | Последние сообщения ядра |

## Управление файлами и каталогами

| Команда | Описание |
|----------|-----------|
| `ls` | Список файлов и каталогов |
| `cd` | Смена текущей директории |
| `pwd` | Показать полный путь текущей директории |
| `mkdir` | Создать каталог |
| `rm` | Удалить файл/каталог |
| `cp` | Копировать файлы/каталоги |
| `mv` | Переместить/переименовать |
| `touch` | Создать файл или обновить временные метки |
| `cat` | Вывести содержимое файла |
| `less` | Постраничный просмотр файла |
| `head` | Первые строки файла |
| `tail` | Последние строки файла |
| `grep` | Поиск текста в файлах/потоках |
| `find` | Поиск файлов по критериям |
| `chmod +x script.sh` | Сделать файл исполняемым |
| `chmod` | Изменить права доступа |
| `chown` | Изменить владельца |
| `chgrp` | Изменить группу |
| `ln -s target link_name` | Символическая ссылка |
| `rsync -avz source/ dest/` | Надёжное копирование/синхронизация |
| `tar -xvf file.tar.gz` | Распаковать архив |
| `tar -cvzf archive.tar.gz dir/` | Создать архив |
| `zip -r archive.zip dir/` | Создать ZIP-архив |
| `unzip archive.zip` | Распаковать ZIP |

## Процессы и диагностика

| Команда | Описание |
|----------|-----------|
| `ps aux \| grep {process}` | Найти процесс по имени |
| `pgrep {name}` | PID’ы по имени процесса |
| `pkill {name}` | Завершить процессы по имени |
| `kill {PID}` / `kill -9 {PID}` | Отправить сигнал процессу |
| `killall {name}` | Завершить все процессы с именем |
| `renice -n -5 -p {PID}` | Изменить приоритет процесса |
| `nice -n 10 command` | Запустить с пониженным приоритетом |
| `top` / `htop` | Мониторинг процессов (CPU/Memory) |
| `strace -p {PID}` | Трассировка системных вызовов процесса |
| `lsof -i :{port}` | Кто слушает порт |
| `lsof` | Открытые файлы/сокеты процессов |
| `journalctl -fu service-name` | Логи systemd-сервиса (follow) |
| `tail -f /var/log/*` | Просмотр логов в реальном времени |
| `less +F` | Альтернатива `tail -f` с прокруткой |
| `grep -r "error" .` | Поиск ошибок в файлах |
| `zcat access.log.gz \| grep "500"` | Анализ сжатых логов |
| `sar -n DEV 1` | Статистика по сетевым интерфейсам |
| `iostat -xz 1` | Производительность дисков |
| `uptime` | Аптайм и нагрузка |
| `time command` | Время выполнения команды |
| `vmstat 1` | Память/IO/процессы в динамике |

## Управление пользователями и группами

| Команда | Описание |
|----------|-----------|
| `adduser {user}` / `useradd {user}` | Создать пользователя |
| `deluser {user}` / `userdel {user}` | Удалить пользователя |
| `usermod` | Изменить параметры пользователя |
| `passwd {user}` | Сменить пароль |
| `groups {user}` | Группы пользователя |
| `id {user}` | UID/GID и группы |
| `who` / `w` | Текущие пользователи и их активность |
| `last` | История входов |
| `finger {user}` | Информация о пользователе (если установлен) |
| `su - {user}` | Переключение пользователя |
| `sudo <cmd>` | Выполнить с привилегиями root |
| `logout` | Выход из текущей сессии |

## Сеть и безопасность

| Команда | Описание |
|----------|-----------|
| `netstat -tulpn` | Активные соединения и слушающие порты |
| `ss -tunlp` | Открытые сокеты (современная альтернатива) |
| `iptables -L` | Правила iptables |
| `tcpdump -i any` | Захват/анализ пакетов |
| `traceroute {host}` | Маршрут до хоста |
| `ping {host}` | Проверка доступности |
| `dig +short {domain}` | Быстрый DNS-запрос |
| `curl -v {url}` | Отладка HTTP(S)-запросов |
| `arp -a` | ARP-таблица |

## Контейнеры (Docker / Podman / Kubernetes / CRI)

| Команда | Описание |
|----------|-----------|
| `docker ps --format '{{.Names}} {{.Status}}'` | Краткий статус контейнеров |
| `docker stats --no-stream` | Быстрое использование ресурсов |
| `docker exec -it {container} bash` | Войти в контейнер |
| `docker logs -f {container}` | Просмотр логов контейнера |
| `podman top` | Просмотр процессов внутри контейнера |
| `crictl logs {container}` | Логи контейнера (CRI runtimes) |
| `kubectl get pods \| grep -i error` | Найти ошибочные Pod’ы в Kubernetes |

## Файлы и операции

| Команда | Описание |
|----------|-----------|
| `find . -name "*.yaml" -type f` | Поиск файлов по шаблону |
| `rsync -avz source/ dest/` | Надежное копирование данных |
| `tar -xvf file.tar.gz` | Распаковка архива |
| `ln -s target link_name` | Создание символической ссылки |
| `chmod +x script.sh` | Сделать файл исполняемым |

## Управление пакетами и приложениями

| Команда | Описание |
|----------|-----------|
| `apt-get update` | Обновить индекс пакетов |
| `apt-get upgrade` | Обновить установленные пакеты |
| `apt-get install <pkg>` | Установить пакет |
| `apt-get remove <pkg>` | Удалить пакет |
| `apt-cache search <term>` | Поиск пакета |
| `dpkg -i file.deb` | Установить локальный `.deb` |
| `dpkg -r <pkg>` | Удалить пакет |
| `dpkg -l` | Список установленных пакетов |
| `snap install <pkg>` | Установить snap |
| `snap remove <pkg>` | Удалить snap |
| `snap list` | Установленные snap-пакеты |

## Управление сервисами

| Команда | Описание |
|----------|-----------|
| `systemctl start <service>` | Запустить службу |
| `systemctl stop <service>` | Остановить службу |
| `systemctl restart <service>` | Перезапустить службу |
| `systemctl status <service>` | Статус службы |
| `systemctl enable <service>` | Включить автозапуск |
| `systemctl disable <service>` | Отключить автозапуск |
| `service <service> start/stop/restart/status` | Альтернативные команды (SysV совместимость) |

## Система и питание

| Команда | Описание |
|----------|-----------|
| `shutdown -h now` | Немедленное выключение |
| `shutdown -r now` | Немедленная перезагрузка |
| `shutdown +10 "msg"` | Запланировать выключение через 10 минут |
| `reboot` | Перезагрузка |
| `halt` / `poweroff` | Выключение |
| `systemctl` | Универсальное управление systemd |
| `ifconfig` / `ip` | Сетевые интерфейсы и конфигурация |
| `ssh user@host` | Подключение по SSH |
| `scp file user@host:/path` | Копирование по SSH |
| `rsync` | Синхронизация/копирование (локально/удалённо) |
| `history` | История команд |
| `nohup cmd &` | Запуск в фоне с игнорированием HUP |

## Планирование задач

| Команда | Описание |
|----------|-----------|
| `crontab -e` | Редактировать cron-задачи пользователя |
| `crontab -l` | Показать cron-задачи |
| `at 22:30` | Выполнить команду в указанное время (одноразово) |

## Git и разработка

| Команда | Описание |
|----------|-----------|
| `git log --oneline` | Компактный вывод истории |
| `git reset --hard HEAD^` | Отмена последнего коммита |
| `git stash` | Временно скрыть изменения |
| `git diff --cached` | Сравнение проиндексированных файлов |
| `git blame {file}` | Кто и когда менял строки файла |

## Управление памятью

| Команда | Описание |
|----------|-----------|
| `free -h` | Использование RAM и swap |
| `smem` | Детальная разбивка памяти по процессам/группам |
| `sync` | Сброс буферов на диск |
| `swapoff -a` / `swapon -a` | Отключить/включить все swap-устройства |
| `sysctl vm.*` | Параметры управления памятью ядра |
| `ulimit -a` | Лимиты ресурсов для сессии/процесса |
| `pmap {PID}` | Карта памяти процесса |
| `slabtop` | Использование slab-кэшей ядром |
| `numactl --hardware` | Инфо по NUMA, привязка памяти/CPU |
| `SysRq` (Magic SysRq) | Низкоуровневые команды ядру (в т.ч. по памяти) |
| `mdb` | **Примечание:** отладчик Solaris (упомянут для полноты, не Linux) |

## Часто используемые сценарии

### Найти процесс по имени

```
bash
ps aux | grep nginx
```

### Проверить, кто держит порт 8080

```
lsof -i :8080
```

### Мониторинг логов

```
journalctl -fu nginx
```

### Проверить проблемные контейнеры

```
docker ps --format '{{.Names}} {{.Status}}' | grep -v Up
```

### Анализ сетевых пакетов по интерфейсу eth0

```
tcpdump -i eth0 port 80
```

### Древо процессов nginx + аптайм (колонка ETIME)

```
ps --forest -C nginx -o ppid,pid,cmd,etime
```